sudo: required
services:
- docker
language: node_js
node_js:
- '5'
env:
  global:
  - COMMIT=${TRAVIS_COMMIT::8}
  - secure: LB4hXQ2NaUmhj5oWDS7KnC3ciX3JHRkepBs7zSpZPUkUQy2tqroU931CPNPtL39JsTmsAunwCyIwuOikqpzA1qioC+uDifZmwBFWfbw5md9kocB9sC+RMNq0s89LeRvkSah0tw8WL108b2i0J1wWcwc59GhxAwt27XshToT08CBIHtxA94aVdKShDyFxSBRuUEQdw3YUzNkjnMfMT/4CBjGizgDl/BWXn8otCJFiCenVTMK4js2zTjPmfq6S0fEI4B+QFmSfrDSqmfjBs5zu6MYDUX8Db28TvLFdPRUZRfnoFzRPVCFAgvGf/lfjjT3MT6XQm/p4BTJV0mvAMPtNTHLi7iKPcg8Hk1Q3WtV2qGdKiv4PRR178sFh+ZwVB9m7ebzhY/MVPf96AEEonnPvh8H3/LDVlbuEf8hFbBClnWTu4of99ywlUxQtVWeYFrAIMS+ygv44RQikDpw5pNYeu9ghgy/841mjBTxQCPJqqFao4ZHQQnTiAtlUwqgWJRjHjzPMfiZJ/J/Nyu5ZUTENIIlEbxxzyapkthRC0tUPpVFxuTLoAPLr81LJQ/gINKWA1BHuij93lPcg0loQh4ZAHdqDcPn1hpSrfsWMzOZOGu8I8QS2HKdnNlJ9jF5Zoz54JltCL4hnWdh/qXiJMuEaPF8MYC3tK7ZSe81Ux0wpJNo=
  - secure: UwV2cnruMQawDlIJcG8OrWXzxAh9AmhGd8xHEvHKJI6wRPbNAf05cKdHbRqHCKepONi58j7OTyEmhq9tWBNc+iDaXqSeygCRgX7rWSSKSaOHZDnNuNodzkCnRu+Bb8Tn7UDZNjUYGS/vl5vZnEvvVfl54KCVa5Hm9x14QbnwjaEYlu/8yczpPcN7u8uEkZGPJBuG/xwDNT7GjPzGAw9UyJuDQNrbDv8bWlPdZr4k5YNIYuYfOYJA/go5Zhz8CC16zBg4C0iBL+3WuYURATQvyih5b2VyHChJ2u4DYndMqL/pcB7gfOkxxMAZIbrTEkcFQlaCCK/XyF2N0fX82wxCFT9jzy7MetXQG3s/Nz3l++or5WKsqYZ0cWJFt//zNWuitla2OBmsTCL4Ya7ZsUBLSBmnmhYzJu9wxWtRxBoO8mNmRWLFaihmcpByT9vPWaySHdFY/Pg4+MgWtKx2JN8eEGbdRevevTG2RGKATsK5VbZon47KkNjlVXT/7LMcMjWg7yAWai21NRi0zoiKo4EiM57rIX5br8XlsiTh5bZtTMDW7qE0OX/oVuN10HGFL41bKSX+AKGKbsCrkFU0LZfS3K8FPRANzYbDFVcpwmbU+9sh3cdAIFVdoynUgIExr2cotvxLMNeT5iuEr4Wg7xQXqQJFz/imNY/1WhK5U+MQ4wA=
script:
- docker build -t ddns-travis .
- docker run -d -P --name ddns-travis ddns-travis
- docker exec ddns-travis grunt test
- docker exec ddns-travis npm install -g codeclimate-test-reporter
- docker exec ddns-travis grunt coverage
- docker exec -it ddns-travis sh -c 'codeclimate-test-reporter < /ddns/coverage/lcov.info'
after_success:
- export REPO=Samisdat/ddns
- export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH;
  fi`
- echo $REPO
- echo $COMMIT
- echo $TAG
- curl -H "Content-Type:application/json" --data '{"build":true}' -X POST https://registry.hub.docker.com/u/samisdat/ddns/trigger/$DOCKER_TOKEN/
